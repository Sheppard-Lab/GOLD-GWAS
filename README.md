# GOLD-GWAS

**GOLD-GWAS** (**G**enome‑wide **O**mission of **L**inkage **D**isequilibrium **G**enome‑wide **W**ide **A**ssociation **S**tudy) is an add‑on tool for [unitig‑caller](https://github.com/bacpop/unitig-caller) and [pyseer](https://github.com/weecology/pyseer) designed to detect genomic co‑variation. GOLD‑GWAS works by masking target genes within unitigs before performing k‑mer‑based GWAS to identify significant variation associated with target‑gene carriage.

**Notes:** All scripts in the `pyseer_codes` directory are adapted from [pyseer](https://github.com/weecology/pyseer) and are included here for ease of use.

---

## Requirements

Before using **GOLD‑GWAS**, ensure the following software are installed:

1. **[minimap2](https://github.com/lh3/minimap2)** (version ≥ 2.24)
2. **[BEDtools](https://bedtools.readthedocs.io/en/latest/)** (version ≥ 2.30.0)
3. **[PLINK 1.9](https://www.cog-genomics.org/plink/1.9/)** (note: PLINK 2 is *not* supported)
4. **[unitig‑caller](https://github.com/bacpop/unitig-caller)** (latest)
5. **[BWA](http://bio-bwa.sourceforge.net/)** (version ≥ 0.7.17)
6. **[pyseer](https://github.com/weecology/pyseer)** (version ≥ 1.3.11)
7. **[ABRicate](https://github.com/tseemann/abricate)** (version ≥ 1.0.0)

---

## Installation

```bash
git clone https://github.com/jeju2486/GOLD-GWAS.git
cd GOLD-GWAS
```

> **Tip**
> GOLD‑GWAS can be installed in a conda or mamba environment with all dependencies pre‑resolved (see `environment.yml`).

---

## Input

To run GOLD‑GWAS you will need:

* Genome assemblies in **FASTA** format **or** a core‑genome alignment file.
* Target sequence(s) to be masked in **FASTA** format **or** start/end coordinates for the target region in tab‑delimited format.
* Genome annotations in **GFF** format.

---

## Usage

### 1 · Calculate Linkage Disequilibrium (LD)

#### a. Using FASTA files

```bash
bash run_ld_calculation.sh \
  -i "/path/to/input_dir" \
  -o "/path/to/output_dir" \
  -t <threads>
```

#### b. Using a core‑alignment file (optional)

If you already have a core‑alignment generated by [PIRATE](https://github.com/SionBayliss/PIRATE) or a similar tool you can speed up variant calling:

```bash
bash run_ld_calculation_from_aln.sh \
  -i "/path/to/pirate_alignment" \
  -o "/path/to/output_dir" \
  -t <threads>
```

---

### 2 · Visualise LD decay (optional)

Plot LD decay with **ggplot2** in R:

```bash
Rscript plotting_lddecay.r \
  -i "/path/to/output_dir/ld_results_sampled.ld" \
  -o "/path/to/output_dir"
```

> The first assembly in the input directory is treated as the reference genome.

---

### 3 · Mask target gene(s)

Run the masking pipeline to generate SAM/BED files and LD information.

#### a. Using a target‑gene FASTA

```bash
bash run_maskfasta.sh \
  -g "/path/to/target_gene.fasta" \
  -i "/path/to/input_dir" \
  -d <LD_threshold> \
  -o "/path/to/output_dir" \
  -t <threads> \
  -x        # optional debug mode (produces verbose output)
```

#### b. Using genomic coordinates

Provide a tab‑delimited file listing the contig and coordinates of each region to mask:

```text
Reference	Gene_presence	Contig	Start	End
GCF_000144955.fas	Yes	NC_017338.2	33707	57871
GCF_000159535.fas	Yes	NC_017342.1	459032	486212
GCF_000189455.fas	No	NZ_CP025395.1	33931	34407
GCF_000568455.fas	Yes	NZ_CP007176.1	34275	88793
```

Run:

```bash
bash run_maskfasta.sh \
  -s "/path/to/target_regions.tsv" \
  -i "/path/to/input_dir" \
  -d <LD_threshold> \
  -o "/path/to/output_dir" \
  -t <threads>
```

---

## Output

```
├── sam/                 # Alignment (SAM) files
├── bed/                 # BED files (simplified SAM)
├── ld_ref/              # LD region FASTA + BED files
└── unitig_output/
    ├── unitig.output.pyseer          # Unitigs for the full genome set
    ├── potential.kmer_output.txt     # k‑mers within LD regions
    └── extracted.unitig.out.pyseer   # Unitigs excluding LD regions (for pyseer)
```

---

## 4 · Run pyseer

GOLD‑GWAS automates execution of **pyseer**:

```bash
bash run_pyseer.sh \
  -t "/path/to/tree.nwk" \
  -p "/path/to/phenotype.tsv" \
  -i "/path/to/unitig_output" \
  -o "/path/to/pyseer_results" \
  -P <prefix>        # optional
  -T <threads>       # optional
  -s "/path/to/pyseer_script.py"
```

---

## 5 · Plot pyseer results (optional)

Produce Manhattan/QQ and annotation plots:

```bash
bash run_pyseer_plotting.sh \
  -r "/path/to/input_fasta_dir" \
  -g "/path/to/gff_dir" \
  -s "/path/to/pyseer_script.py" \
  -o "/path/to/pyseer_results" \
  -p <prefix>
```

Annotation plot (from the original pyseer tutorial):

```bash
Rscript plotting_annotation.R \
  /path/to/pyseer_results/gene_hits_saureus.txt \
  annotation pdf svg
```

> The prefix should match that used in `run_pyseer.sh`.

---

## Contact

Please open an issue on the [GitHub repository](https://github.com/jeju2486/GOLD-GWAS) or contact the maintainer for questions, bug reports, or contributions.

---

© 2025 – GOLD‑GWAS development team. Released under the MIT License.
